apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: numinia
resources:
- deployment.yaml
- service.yaml
- route.yaml
- middleware.yaml
- autoscaling.yaml
configMapGenerator:
- behavior: create
  envs:
  - config.env
  name: alchemist-tower-config
replacements:
- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.MEMORY
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].resources.requests.memory
- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.LIMITS_MEMORY
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].resources.limits.memory
- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.CPU
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].resources.requests.cpu
- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.LIMITS_CPU
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].resources.limits.cpu

- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.PUBLIC_WS_URL
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].env.[name=PUBLIC_WS_URL].value

- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.PUBLIC_API_URL
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].env.[name=PUBLIC_API_URL].value

- source:
    kind: ConfigMap
    name: alchemist-tower-config
    fieldPath: data.PUBLIC_ASSETS_URL
  targets:
  - select:
      kind: Deployment
    fieldPaths:
    - spec.template.spec.containers.[name=alchemist-tower].env.[name=PUBLIC_ASSETS_URL].value
labels:
- includeSelectors: true
  pairs:
    app: alchemist-tower
    pod-type: alchemist-tower
spec:
  dependsOn:
    - name: traefik