apiVersion: v1
kind: ConfigMap
metadata:
  name: alchemist-tower-pre-values
  namespace: numinia
  annotations:
    config-version: "1.0.0"
    autoscaling.knative.dev/metric: "{{ .Values.knative.autoscaling.metric }}"
    autoscaling.knative.dev/target: "{{ .Values.knative.autoscaling.target }}"
    autoscaling.knative.dev/min-scale: "{{ .Values.knative.autoscaling.minScale }}"
    autoscaling.knative.dev/max-scale: "{{ .Values.knative.autoscaling.maxScale }}"
    autoscaling.knative.dev/window: "{{ .Values.knative.autoscaling.window }}"
    autoscaling.knative.dev/scale-down-delay: "{{ .Values.knative.autoscaling.scaleDownDelay }}"
    autoscaling.knative.dev/scale-to-zero-grace-period: "{{ .Values.knative.autoscaling.scaleToZeroGracePeriod }}"
data:
  values.yaml: |
    orgName: "numinia"
    appName: "alchemist-tower"
    environment: "pre"
    serviceAccountName: "aws-secret-manager-sa"
    image:
      repository: "ghcr.io/hyperfy-xyz/hyperfy"
      tag: "sha-ce5403a0fe4cb550bf0f9ccea78c25e1b959cd99"
    world: "alchemist-tower"
    tlsSecretName: "numinia-tls"
    hostname: "pre.alchemist-tower.numinia.xyz"
    storagePath: "/mnt/hyperfy2-persistent-storage"
    publicWsUrl: "https://pre.alchemist-tower.numinia.xyz/ws"
    publicApiUrl: "https://pre.alchemist-tower.numinia.xyz/api"
    publicAssetsUrl: "https://pre.alchemist-tower.numinia.xyz/assets"
    publicMaxUploadSize: "100MB"
    knative:
      enabled: true
      autoscaling:
        metric: "concurrency"
        target: "100"
        minScale: "0"
        maxScale: "1"
        window: "60s"
        scaleDownDelay: "0s"
        scaleToZeroGracePeriod: "500s"
    resources:
      requests:
        cpu: "256m"
        memory: "256Mi"
      limits:
        cpu: "512m"
        memory: "512Mi"